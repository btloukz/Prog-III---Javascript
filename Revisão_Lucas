import {select, input, number} from '@inquirer/prompts'
import api from './CrudAPI.js'

async function menu() {
    const opcao = await select({
        message: "Escolha uma opção...",
        choices: [
            { title: 'Criar novo registro', value: 'criar' },
            { title: 'Listar todos os registros', value: 'listarTodos' },
            { title: 'Buscar registro por ID', value: 'buscarPorId' },
            { title: 'Atualizar registro', value: 'atualizar' },
            { title: 'Excluir registro', value: 'excluir' },
            { title: 'Tudo em maiúscula', value: 'tudoMaiuscula' },
            { title: 'Sobrenome primeiro', value: 'sobrenomePrimeiro' },
            { title: 'Pesquisa por nome', value: 'pesquisarPorNome' },
            { title: 'Sair', value: 'sair' },
        ]
    })

    switch(opcao){
        case 'criar':
            await criarRegistro ()
            break;
        case 'listarTodos':
            await lerRegistros ()
            break;
        case 'buscarPorId':
           await buscaPorId()
            break;
        case 'atualizar':
            break;
        case 'excluir':
            break;
        case 'tudoMaiuscula':
            break;
        case 'sobrenomePrimeiro':
            break;
        case 'pesquisarPorNome':
            break;
    }
    await menu();
}

async function criarRegistro (){
    let nome = await input({message: "Digite seu nome para registro: "})
    let email = await input({message: "Agora, digite seu email: "})

    let novoRegistro = await api.criar({nome, email})
    console.log(`Seja bem vindo! Suas informações: ID: ${novoRegistro.id} - Nome: ${novoRegistro.nome} - Email: ${novoRegistro.email}`)
}

async function lerRegistros (){
    let leitura = await api.lerTodos({})
    leitura.forEach((registro)=>{
        console.log(`ID: ${registro.id}, Nome: ${registro.nome}, Email: ${registro.email}`)
    })
}

async function buscaPorId(){
    let id = await number({message: "Digite o ID pra capturarmos: "})
    let valor = await api.lerPorId(id)
    if(valor){
        console.log(`Aqui está o resultado da sua busca pelo id ${valor.id} - Nome: ${valor.nome}, Email: ${valor.email}`)
    } else {
        console.error("Registro inexistente!")
    }
}
menu();
